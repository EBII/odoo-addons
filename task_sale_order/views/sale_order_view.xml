<?xml version="1.0"?>
<openerp>
    <data>
        
        <record model="ir.ui.view" id="view_order_form1">
            <field name="name">Show task stage in sale order line detail</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']/form/field[@name='state']" position="before">
                    <div groups="base.group_user" id="tasks" attrs="{'invisible': [('task_ids', '=', [])]}">
                        <br/>
                        <label for="task_ids"/>
	                    <field name="task_ids" readonly="1">
	                        <tree>
	                            <field name="date_deadline"/>
	                            <field name="name"/>
	                            <field name="user_id"/>
	                            <field name="planned_hours"/>
	                            <field name="effective_hours"/>
	                            <field name="remaining_hours"/>
	                            <field name="stage_id"/>
	                        </tree>
	                    </field>
                    </div>
                </xpath>
            </field>
        </record>
        
 
        <record model="ir.ui.view" id="view_order_form2">
            <field name="name">Show task completion in sale order line</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']/tree/field[last()]" position="after">
                    <field name="so_tasks_count" invisible="1"/>
                    <field name="task_completion" string="Done (%)" groups="base.group_user" 
                        attrs="{'invisible':[('so_tasks_count', '=', 0)]}"/>
                </xpath>
            </field>
        </record>
 
        <record model="ir.ui.view" id="view_order_form3">
            <field name="name">Show overall completion</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_service.view_order_form_inherit_sale_service"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='payment_term_id']" position="after">
                    <field name="task_completion" groups="base.group_user" 
                        widget="progressbar"
                        attrs="{'invisible': [('tasks_count', '=', 0)]}"
                        string="Done (%)"/>
                </xpath>
           </field>
        </record>
        
        
        <record model="ir.ui.view" id="view_order_form4">
            <field name="name">Show task completion in sale order</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="after">
                    <field name="task_completion" groups="base.group_user" 
                        string="Completion (%)"/>
                </xpath>
           </field>
        </record>
        
        
    </data>
</openerp>
